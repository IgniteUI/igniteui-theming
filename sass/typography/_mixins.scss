@use 'sass:map';
@use 'sass:string';
@use 'sass:list';
@use '../utils/meta' as *;
@use './types';

////
/// @group Typography
////

/// Includes all category related styles into the current style block.
/// @param {String} $category - The type scale category.
/// @param {String} $check [true] - Toggles category checks against ITypeScale.
/// Set to false when using a custom type scale.
/// @example scss Add the `h1` styles to custom CSS selector.
///   .fancy-h1 {
///      @include type-style('h1');
///      color: mediumvioletred;
///   }
@mixin type-style($category, $check: true) {
    $valid: if($check, list.index(types.$ITypeScale, $category), true);

    @if $valid {
        @each $key, $value in types.$ITypeStyle {
            #{$key}: var(--ig-#{$category}-#{$key});
        }
        @content;
    } @else {
        @warn '#{$category} is not a valid type style';
    }
}

/// Transforms a type style map into css font variables.
/// @param {String} $name - The custom CSS variable name.
/// @param {Map} $type-style - A type style map reference as produced by type-style.
/// @example scss Assign the `h1` styles to custom CSS property using the CSS font shorthand syntax.
///   $h1-style: type-scale-category($type-scale, 'h1');
///   @include type-style-vars('h1', $h1-style);
@mixin type-style-vars($name, $type-style) {
    @each $key, $value in map.remove($type-style, '_meta') {
        --ig-#{$name}-#{$key}: #{$value};
    }
}

/// Styles all native elements that match the IElementCategories map.
/// @requires {mixin} type-style
/// @requires $ITypeScale
/// @requires $IElementCategories
@mixin type-style-elements() {
    @each $category in types.$ITypeScale {
        // Get the native element that uses typographic styles directly
        // as mapped in the $IElementCategories
        $e: map.get(types.$IElementCategories, $category);

        // Add native element typographic styles.
        @if $e {
            #{$e} {
                @include type-style($category);
            }
        }
    }
}

/// Creates CSS classes with style rules for all categories in the ITypeScale map.
/// @requires {mixin} type-style
/// @requires $ITypeScale
@mixin type-style-classes() {
    @each $category in types.$ITypeScale {
        // Add class selector typographic styles.
        &__#{$category} {
            @include type-style($category);
        }
    }
}

/// Adds typography styles for h1-h6, paragraph and creates custom typography class selectors.
/// The produced styles are based on the passed typeface and type scale.
/// @access public
/// @param {String} $font-family - The font family to be used across all typographic elements.
/// @param {Map} $type-scale - A type scale map as produced by the type-scale function.
/// @requires {function} is-root
/// @requires {mixin} type-style-vars
/// @requires {mixin} type-style-classes
/// @requires {mixin} type-style-elements
@mixin typography($font-family, $type-scale) {
    $scope: if(is-root(), ':root', '&');

    #{$scope} {
        --ig-font-family: #{string.unquote($font-family)};

        @each $name, $style in map.remove($type-scale, '_meta') {
            @include type-style-vars($name, $style);
        }
    }

    @if is-root() {
        .ig-typography {
            @include type-style-classes();
            @include type-style-elements();
        }
    }
}
